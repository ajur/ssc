var A=Object.defineProperty;var w=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var S=(s,e,t)=>e in s?A(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,u=(s,e)=>{for(var t in e||(e={}))E.call(e,t)&&S(s,t,e[t]);if(w)for(var t of w(e))D.call(e,t)&&S(s,t,e[t]);return s};var r=(s,e,t)=>(S(s,typeof e!="symbol"?e+"":e,t),t);import{I as d,g as a,L as y,W as H,C as m,S as b,r as v,a as V,T as g,N as z,b as G,c as T,d as F,P as $,e as U,A as R,t as Y}from"./vendor.b3dd6144.js";const j=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}};j();const _={clamp:(s,e,t)=>s<e?e:s>t?t:s},x={load:K,loadDefault:C,save:X},J={debounce:Q};function K(s){return C(s,void 0)}function C(s,e){const t=globalThis.localStorage.getItem(s);return t?JSON.parse(t):e}function X(s,e){globalThis.localStorage.setItem(s,JSON.stringify(e))}function Q(s,e=300){let t;return function(...o){clearTimeout(t),t=setTimeout(()=>{s.apply(this,o)},e)}}const q="sound_config",Z={volume:.5,musicVolume:.5};class ee{constructor(){r(this,"config");r(this,"_currentTrack");r(this,"saveConfig");this.saveConfig=J.debounce(()=>x.save(q,this.config)),this.config=x.loadDefault(q,u({},Z)),d.volumeAll=this.config.volume}playMusic(e){const t=d.find(e);if(!t){console.warn(`Music track ${e} not found!`);return}t!=this._currentTrack&&(this._currentTrack&&this.fadeOut(this._currentTrack),t.loop=!0,this.fadeIn(t,{isMusic:!0}),this._currentTrack=t)}get currentTrack(){return this._currentTrack}get volume(){return this.config.volume}set volume(e){d.volumeAll=this.config.volume=_.clamp(e,0,1),this.saveConfig()}get musicVolume(){return this.config.musicVolume}set musicVolume(e){if(e===this.config.musicVolume)return;const t=_.clamp(e,0,1);this._currentTrack&&(this._currentTrack.volume=t,t>0&&!this._currentTrack.isPlaying&&this.fadeIn(this._currentTrack)),this.config.musicVolume=t,this.saveConfig()}fadeIn(e,{duration:t=.5,isMusic:o=!1}={}){if(this.volume==0||o&&this.musicVolume==0)return;const n=o?this.config.musicVolume:1;e.volume=0,e.play(),a.timeline().to(e,{volume:n,duration:t,ease:"sine.inOut"})}fadeOut(e,{duration:t=.5}={}){a.timeline().to(e,{volume:0,duration:t,ease:"sine.inOut"}).call(()=>{e.stop()})}addSoundsControlPanel(e){const t=e.addFolder({title:"Sound"});t.addInput(this,"volume",{min:0,max:1,step:.1,label:"global volume"}),t.addInput(this,"musicVolume",{min:0,max:1,step:.1,label:"music volume"})}}const L=new ee;const te=s=>e=>{var t;return(t=e.sound)==null?void 0:t.addSprites(s)},se={"note-0":{start:0,end:1},"note-1":{start:1,end:2},"note-2":{start:2,end:3},"note-3":{start:3,end:4},"note-4":{start:4,end:5},"note-5":{start:5,end:6}};function oe(){return[{url:"/simon/TeacherA.ttf",name:"TeacherA"},{url:"/simon/AegrisOutlineRegular.ttf",name:"AegisOutlet"},{url:"/simon/simon.json"},{url:"/simon/music.mp3",name:"simon_music"},{url:"/simon/notes.mp3",name:"simon_notes",onComplete:te(se)}]}y.registerPlugin(H);function ne({onLoaded:s,onClicked:e,onRevealed:t,revealTime:o=.3,logoAnimTime:n=1}){const i=document.querySelector("#preloader"),l=i.querySelector(".preloader-footer"),c=i.querySelector("svg path"),p=c.getTotalLength();c.style.strokeDasharray=`${p} ${p}`,c.style.strokeDashoffset=`${p}`,a.to(c.style,{duration:n,strokeDashoffset:0,ease:"power2.inOut"});const M=()=>{a.killTweensOf(c.style),i.remove(),t==null||t()},W=()=>{a.to(i,{duration:o,top:"-100%",onComplete:M}),e==null||e()},B=(...f)=>{h.onProgress.detachAll(),l.innerHTML='<span class="blink">ready</div>',i.addEventListener("pointerdown",W,{once:!0}),s(...f)},N=f=>{l.style.width=`${f.progress}%`},h=y.shared;h.onProgress.add(N),h.onComplete.once(B),h.add(oe()),h.load()}const O=["Too much!","Too many hits.","Why so hasty?","Not so fast.","Bad forcast.","Wait for it!"],ie=v(0,O.length),re=()=>O[ie()],P=["Error.","Wrong one.","Boom! Wrong!","Bad luck!","You missed!","Not this one.","Ouch! Wrong.","Too hard to remember?"],ae=v(0,P.length),le=()=>P[ae()],I=[{img:"/simon/ss_lights_0_yellow.png",note:"note-0"},{img:"/simon/ss_lights_1_green.png",note:"note-1"},{img:"/simon/ss_lights_2_cyan.png",note:"note-2"},{img:"/simon/ss_lights_3_blue.png",note:"note-3"},{img:"/simon/ss_lights_4_purple.png",note:"note-4"},{img:"/simon/ss_lights_5_red.png",note:"note-5"}];class ce extends m{constructor(){super();r(this,"baseSprite");r(this,"segments");r(this,"notes");r(this,"sequence",[]);r(this,"sequenceTimeline");r(this,"tappedSequence",[]);r(this,"nextLevelTimeout");r(this,"getNextSequenceIndex");const e=this.baseSprite=b.from("/simon/ss_lights_base.png");e.anchor.set(.5),this.addChild(e);const t=this.segments=this.createSegments();this.addChild(...t),this.notes=d.find("simon_notes"),this.getNextSequenceIndex=v(0,t.length),this.interactive=!1,this.hitArea=new V(0,0,e.width/2),g.shared.add(this.rotate,this),this.on("pointerdown",this.clicked,this)}rotate(){this.rotation+=3e-4}resetSequence(){var e;this.sequence=[],this.tappedSequence=[],(e=this.sequenceTimeline)==null||e.kill(),this.nextLevelTimeout&&clearTimeout(this.nextLevelTimeout)}extendSequence(){this.sequence.push(this.getNextSequenceIndex())}get level(){return this.sequence.length}newGame(){this.resetSequence(),this.nextLevel()}nextLevel(){this.interactive=!1,this.extendSequence(),this.emit("set_msg",`Level ${this.level}`),this.playSequence(1)}gameOver(e){this.errSound(),this.nextLevelTimeout&&clearTimeout(this.nextLevelTimeout),this.interactive=!1,this.emit("game_over",e,this.level-1)}playSequence(e=0){const t=this.sequenceTimeline=a.timeline({delay:e});this.sequence.forEach(o=>t.add(this.lightUpSegment(o),"<0.667")),t.call(()=>{this.tappedSequence=[],this.interactive=!0})}clicked(e){const t=this.getClickedSegmentIndex(e);this.lightUpSegment(t,!0),this.checkSeqClick(t)}getClickedSegmentIndex(e){const t=e.data.getLocalPosition(this),o=Math.atan2(t.y,t.x);return(Math.floor((o+Math.PI/2)/(Math.PI/3))+6)%6}checkSeqClick(e){if(this.tappedSequence.length>=this.sequence.length){this.gameOver(re());return}const t=this.sequence[this.tappedSequence.length];if(e!==t){this.gameOver(le());return}this.tappedSequence.push(e),this.tappedSequence.length==this.sequence.length&&(this.nextLevelTimeout=setTimeout(()=>{this.okSound(),this.nextLevel()},1e3))}lightUpSegment(e,t=!1){const o=this.segments[e],n=I[e].note,i=a.timeline().call(()=>{this.notes.play(n)});return t?i.fromTo(o,{alpha:1},{alpha:0,duration:.5,ease:"power2.in"}):(i.to(o,{alpha:1,duration:.1,ease:"power2.out"}),i.to(o,{alpha:0,duration:.6,ease:"power2.in"})),i}createSegments(){return I.map(e=>{const t=b.from(e.img);return t.anchor.set(.5),t.alpha=0,t})}okSound(){["note-1","note-3","note-5"].forEach((e,t)=>setTimeout(()=>this.notes.play(e),t*50))}errSound(){["note-0","note-3","note-4"].forEach(e=>this.notes.play(e))}destroy(e){g.shared.remove(this.rotate,this),super.destroy(e)}}class he extends m{constructor(e,t,o=""){super();r(this,"_panelWidth");r(this,"_panelHeight");r(this,"bkg");r(this,"msg");this._panelWidth=e,this._panelHeight=t,this.bkg=this.addChild(this.createBackground(e,t)),this.msg=this.addChild(this.createMsg(e,o)),this.show(o,!0)}show(e="",t=!1,o=!1){this.msg.text=e;const n=a.timeline().set(this,{visible:!0}).add([a.fromTo(this.scale,{x:0},{x:1,ease:"power2.out",duration:.2}),a.fromTo(this,{alpha:0},{alpha:1,ease:"power2.out",duration:.2})]).set(this,{interactive:!0},o?"<1":">");t&&n.progress(1)}hide(){this.interactive=!1,a.timeline().to(this.scale,{x:0,ease:"power2.out",duration:.2}).to(this,{alpha:0,ease:"power2.in",duration:.2},"<").set(this,{visible:!1})}createBackground(e,t){const o=new z(G.from("/simon/glassPanel.png"),10,10,10,10);return o.width=e,o.height=t,o.position.set(-e/2,-t/2),o.renderable=!1,o}createMsg(e,t){const o=new T(t!=null?t:"",{fill:15198183,fontSize:32,padding:15,fontFamily:"AegisOutlet",wordWrap:!0,wordWrapWidth:e*.9,align:"center"});return o.anchor.set(.5),o}}function ue(s,e,t){const o=s.getLocalBounds(),n=Math.max(1,o.width),i=Math.max(1,o.height);return Math.min(e/n,t/i)}function k(...s){return Math.min(1,ue(...s))}class de extends m{constructor(e,t){super();r(this,"bkg");r(this,"bottom");r(this,"sceneWidth");r(this,"sceneHeight");r(this,"starShip");r(this,"txt");r(this,"popup");r(this,"title");this.sceneWidth=e,this.sceneHeight=t,this.bkg=this.addChild(this.createBkg()),this.bottom=this.addChild(new m),this.txt=this.bottom.addChild(this.infoText()),this.starShip=this.addChild(new ce),this.title=this.addChild(this.createTitle()),this.popup=this.addChild(new he(400,400,`Welcome!
Click to start new game.`)),this.popup.on("pointertap",this.newGame,this),this.starShip.on("set_msg",this.logMsg,this),this.starShip.on("game_over",this.gameOver,this),this.resize(e,t),g.shared.add(this.moveBackground,this)}newGame(){console.log("new game!"),this.popup.hide(),this.starShip.newGame()}logMsg(e){this.txt.text=e}gameOver(e,t){this.logMsg(e),this.popup.show(`Game Over!
You managed to remember ${t} beats!
Click to start new game.`,!1,!0)}createBkg(){return F.from("/simon/background.png",{width:this.width,height:this.height})}createTitle(){const e=new T("SpaceSimon",{fill:15198183,fontSize:64,padding:15,fontFamily:"TeacherA"});return e.anchor.set(.5),e}infoText(){const e=new T("",{fill:15198183,fontSize:32,padding:15,fontFamily:"AegisOutlet"});return e.anchor.set(.5),e}resize(e,t){this.bkg.width=e,this.bkg.height=t;const o=e*.95,n=t*.95;this.starShip.position.set(e/2,t/2),this.starShip.scale.set(k(this.starShip,o,n)),this.title.anchor.set(.5,0),this.title.position.set(e/2,10),this.popup.position.set(e/2,t/2),this.popup.scale.set(k(this.popup,o,n));const i=k(this.bottom,o,n);this.bottom.scale.set(i);const l=this.bottom.getLocalBounds();this.bottom.position.set(e/2,t-l.height*i)}moveBackground(){this.bkg.tilePosition.y=(this.bkg.tilePosition.y+.1)%this.bkg.texture.height}destroy(e){g.shared.remove(this.moveBackground,this),super.destroy(e)}}function me(s,e){const t=window;t.gsap=a,t.PIXI=u(u({},$),U),t.APP=s,t.MENU=e}ne({onLoaded:ge,onClicked:pe});function ge(){var n;const s=new R({resolution:window.devicePixelRatio||1,autoDensity:!0,resizeTo:window,backgroundColor:0});((n=document.querySelector("#app"))!=null?n:document.body).appendChild(s.view);const t=new de(s.screen.width,s.screen.height);s.stage.addChild(t),s.renderer.on("resize",t.resize,t);const o=fe();me(s,o)}function pe(){L.playMusic("simon_music")}function fe(){const s=document.getElementById("menu"),e=document.getElementById("menu-toggle"),t=document.getElementById("menu-container"),o=new Y.exports.Pane({container:t});return L.addSoundsControlPanel(o),e.addEventListener("pointerdown",()=>{s.classList.toggle("closed")}),o.addSeparator(),o.addButton({title:"Close menu"}).on("click",()=>{s.classList.add("closed")}),o}
