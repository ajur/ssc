var F=Object.defineProperty,H=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var v=(s,e,t)=>e in s?F(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,u=(s,e)=>{for(var t in e||(e={}))z.call(e,t)&&v(s,t,e[t]);if(k)for(var t of k(e))G.call(e,t)&&v(s,t,e[t]);return s},y=(s,e)=>H(s,V(e));var r=(s,e,t)=>(v(s,typeof e!="symbol"?e+"":e,t),t);import{I as d,g as a,L as b,W as $,C as m,S as T,r as w,a as R,T as g,b as U,c as x,d as _,M as C,P as Y,e as j,A as J,t as K}from"./vendor.e87aa0f2.js";const X=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}};X();const q={clamp:(s,e,t)=>s<e?e:s>t?t:s},L={load:Z,loadDefault:O,save:ee},Q={debounce:te};function Z(s){return O(s,void 0)}function O(s,e){const t=globalThis.localStorage.getItem(s);return t?JSON.parse(t):e}function ee(s,e){globalThis.localStorage.setItem(s,JSON.stringify(e))}function te(s,e=300){let t;return function(...o){clearTimeout(t),t=setTimeout(()=>{s.apply(this,o)},e)}}const P="sound_config",se={volume:.5,musicVolume:.5};class oe{constructor(){r(this,"config");r(this,"_currentTrack");r(this,"saveConfig");this.saveConfig=Q.debounce(()=>L.save(P,this.config)),this.config=L.loadDefault(P,u({},se)),d.volumeAll=this.config.volume}playMusic(e){const t=d.find(e);if(!t){console.warn(`Music track ${e} not found!`);return}t!=this._currentTrack&&(this._currentTrack&&this.fadeOut(this._currentTrack),t.loop=!0,this.fadeIn(t,{isMusic:!0}),this._currentTrack=t)}get currentTrack(){return this._currentTrack}get volume(){return this.config.volume}set volume(e){d.volumeAll=this.config.volume=q.clamp(e,0,1),this.saveConfig()}get musicVolume(){return this.config.musicVolume}set musicVolume(e){if(e===this.config.musicVolume)return;const t=q.clamp(e,0,1);this._currentTrack&&(this._currentTrack.volume=t,t>0&&!this._currentTrack.isPlaying&&this.fadeIn(this._currentTrack)),this.config.musicVolume=t,this.saveConfig()}fadeIn(e,{duration:t=.5,isMusic:o=!1}={}){if(this.volume==0||o&&this.musicVolume==0)return;const i=o?this.config.musicVolume:1;e.volume=0,e.play(),a.timeline().to(e,{volume:i,duration:t,ease:"sine.inOut"})}fadeOut(e,{duration:t=.5}={}){a.timeline().to(e,{volume:0,duration:t,ease:"sine.inOut"}).call(()=>{e.stop()})}addSoundsControlPanel(e){const t=e.addFolder({title:"Sound"});t.addInput(this,"volume",{min:0,max:1,step:.1,label:"global volume"}),t.addInput(this,"musicVolume",{min:0,max:1,step:.1,label:"music volume"})}}const M=new oe;function ie(){return[{url:"/simon/TeacherA.ttf",name:"TeacherA"},{url:"/simon/AegrisOutlineRegular.ttf",name:"AegisOutlet"},{url:"/simon/simon.json"},{url:"/simon/music.mp3",name:"simon_music"},{url:"/simon/notes.mp3",name:"simon_notes",onComplete:re(ne)}].map(ae)}const ne={"note-0":{start:0,end:1},"note-1":{start:1,end:2},"note-2":{start:2,end:3},"note-3":{start:3,end:4},"note-4":{start:4,end:5},"note-5":{start:5,end:6}},re=s=>e=>{var t;return(t=e.sound)==null?void 0:t.addSprites(s)},ae=s=>{var e;return((e=s.url)==null?void 0:e.startsWith("/"))?y(u({},s),{url:"/ssc/"+s.url.substring(1)}):s};b.registerPlugin($);function le({onLoaded:s,onClicked:e,onRevealed:t,revealTime:o=.3,logoAnimTime:i=1}){const n=document.querySelector("#preloader"),l=n.querySelector(".preloader-footer"),c=n.querySelector("svg path"),f=c.getTotalLength();c.style.strokeDasharray=`${f} ${f}`,c.style.strokeDashoffset=`${f}`,a.to(c.style,{duration:i,strokeDashoffset:0,ease:"power2.inOut"});const E=()=>{a.killTweensOf(c.style),n.remove(),t==null||t()},A=()=>{a.to(n,{duration:o,top:"-100%",onComplete:E}),e==null||e()},D=(...S)=>{h.onProgress.detachAll(),l.innerHTML='<span class="blink">ready</div>',n.addEventListener("pointerdown",A,{once:!0}),s(...S)},N=S=>{l.style.width=`${S.progress}%`},h=b.shared;h.onProgress.add(N),h.onComplete.once(D),h.add(ie()),h.load()}const I=["Too much!","Too many hits.","Why so hasty?","Not so fast.","Bad forcast.","Wait for it!"],ce=w(0,I.length),he=()=>I[ce()],W=["Error.","Wrong one.","Boom! Wrong!","Bad luck!","You missed!","Not this one.","Ouch! Wrong.","Too hard to remember?"],ue=w(0,W.length),de=()=>W[ue()],B=[{img:"simon/ss_lights_0_yellow.png",note:"note-0"},{img:"simon/ss_lights_1_green.png",note:"note-1"},{img:"simon/ss_lights_2_cyan.png",note:"note-2"},{img:"simon/ss_lights_3_blue.png",note:"note-3"},{img:"simon/ss_lights_4_purple.png",note:"note-4"},{img:"simon/ss_lights_5_red.png",note:"note-5"}];class me extends m{constructor(){super();r(this,"baseSprite");r(this,"segments");r(this,"notes");r(this,"sequence",[]);r(this,"sequenceTimeline");r(this,"tappedSequence",[]);r(this,"nextLevelTimeout");r(this,"getNextSequenceIndex");const e=this.baseSprite=T.from("simon/ss_lights_base.png");e.anchor.set(.5),this.addChild(e);const t=this.segments=this.createSegments();this.addChild(...t),this.notes=d.find("simon_notes"),this.getNextSequenceIndex=w(0,t.length),this.interactive=!1,this.hitArea=new R(0,0,e.width/2),g.shared.add(this.rotate,this),this.on("pointerdown",this.clicked,this)}rotate(){this.rotation+=3e-4}resetSequence(){var e;this.sequence=[],this.tappedSequence=[],(e=this.sequenceTimeline)==null||e.kill(),this.nextLevelTimeout&&clearTimeout(this.nextLevelTimeout)}extendSequence(){this.sequence.push(this.getNextSequenceIndex())}get level(){return this.sequence.length}newGame(){this.resetSequence(),this.nextLevel()}nextLevel(){this.interactive=!1,this.extendSequence(),this.emit("set_msg",`Level ${this.level}`),this.playSequence(1)}gameOver(e){this.errSound(),this.nextLevelTimeout&&clearTimeout(this.nextLevelTimeout),this.interactive=!1,this.emit("game_over",e,this.level-1)}playSequence(e=0){const t=this.sequenceTimeline=a.timeline({delay:e});this.sequence.forEach(o=>t.add(this.lightUpSegment(o),"<0.667")),t.call(()=>{this.tappedSequence=[],this.interactive=!0,this.nextLevelTimeout=setTimeout(()=>{this.gameOver("Don't wait so long. Repeat whole pattern.")},5e3)})}clicked(e){const t=this.getClickedSegmentIndex(e);this.lightUpSegment(t,!0),this.checkSeqClick(t)}getClickedSegmentIndex(e){const t=e.data.getLocalPosition(this),o=Math.atan2(t.y,t.x);return(Math.floor((o+Math.PI/2)/(Math.PI/3))+6)%6}checkSeqClick(e){if(clearTimeout(this.nextLevelTimeout),this.tappedSequence.length>=this.sequence.length){this.gameOver(he());return}const t=this.sequence[this.tappedSequence.length];if(e!==t){this.gameOver(de());return}this.tappedSequence.push(e),this.tappedSequence.length==this.sequence.length?this.nextLevelTimeout=setTimeout(()=>{this.okSound(),this.nextLevel()},1e3):this.nextLevelTimeout=setTimeout(()=>{this.gameOver("Don't wait so long. Repeat whole pattern.")},5e3)}lightUpSegment(e,t=!1){const o=this.segments[e],i=B[e].note,n=a.timeline().call(()=>{this.notes.play(i)});return t?n.fromTo(o,{alpha:1},{alpha:0,duration:.5,ease:"power2.in"}):(n.to(o,{alpha:1,duration:.1,ease:"power2.out"}),n.to(o,{alpha:0,duration:.6,ease:"power2.in"})),n}createSegments(){return B.map(e=>{const t=T.from(e.img);return t.anchor.set(.5),t.alpha=0,t})}okSound(){["note-1","note-3","note-5"].forEach((e,t)=>setTimeout(()=>this.notes.play(e),t*50))}errSound(){["note-0","note-3","note-4"].forEach(e=>this.notes.play(e))}destroy(e){g.shared.remove(this.rotate,this),super.destroy(e)}}class ge extends m{constructor(e,t,o=""){super();r(this,"_panelWidth");r(this,"_panelHeight");r(this,"bkg");r(this,"msg");this._panelWidth=e,this._panelHeight=t,this.bkg=this.addChild(this.createBackground(e,t)),this.msg=this.addChild(this.createMsg(e,o)),this.show(o,!0)}show(e="",t=!1,o=!1){this.msg.text=e;const i=a.timeline().set(this,{visible:!0}).add([a.fromTo(this.scale,{x:0},{x:1,ease:"power2.out",duration:.2}),a.fromTo(this,{alpha:0},{alpha:1,ease:"power2.out",duration:.2})]).set(this,{interactive:!0},o?"<1":">");t&&i.progress(1)}hide(){this.interactive=!1,a.timeline().to(this.scale,{x:0,ease:"power2.out",duration:.2}).to(this,{alpha:0,ease:"power2.in",duration:.2},"<").set(this,{visible:!1})}createBackground(e,t){const o=T.from(U.EMPTY);return o.width=e,o.height=t,o.anchor.set(.5),o}createMsg(e,t){const o=new x(t!=null?t:"",{fill:15198183,fontSize:32,padding:15,fontFamily:"AegisOutlet",wordWrap:!0,wordWrapWidth:e*.9,align:"center"});return o.anchor.set(.5),o}}function pe(s,e,t){const o=s.getLocalBounds(),i=Math.max(1,o.width),n=Math.max(1,o.height);return Math.min(e/i,t/n)}function p(...s){return Math.min(1,pe(...s))}class fe extends m{constructor(e,t){super();r(this,"bkg");r(this,"bottom");r(this,"sceneWidth");r(this,"sceneHeight");r(this,"starShip");r(this,"txt");r(this,"popup");r(this,"title");this.sceneWidth=e,this.sceneHeight=t,this.bkg=this.addChild(this.createBkg()),this.bottom=this.addChild(new m),this.txt=this.bottom.addChild(this.infoText()),this.starShip=this.addChild(new me),this.title=this.addChild(this.createTitle()),this.popup=this.addChild(new ge(400,400,`Welcome!

Click to start new game.`)),this.popup.on("pointertap",this.newGame,this),this.starShip.on("set_msg",this.logMsg,this),this.starShip.on("game_over",this.gameOver,this),this.resize(e,t),g.shared.add(this.moveBackground,this)}newGame(){this.popup.hide(),this.starShip.newGame()}logMsg(e){this.txt.text=e}gameOver(e,t){this.logMsg(e),this.popup.show(`Game Over!
You managed to remember ${t} beats!
Click to start new game.`,!1,!0)}createBkg(){const e=_.from("simon/background.png",{width:this.width,height:this.height});return e.texture.baseTexture.mipmap=C.OFF,e}createTitle(){const e=new x("SpaceSimon",{fill:15198183,fontSize:64,padding:15,fontFamily:"TeacherA"});e.anchor.set(.5,0);const t=_.from("simon/titleBackgrund.png",{width:e.width,height:e.height});return t.texture.baseTexture.mipmap=C.OFF,t.anchor.set(.5,0),t.mask=t.addChild(e),t}infoText(){const e=new x("",{fill:15198183,fontSize:32,padding:15,fontFamily:"AegisOutlet"});return e.anchor.set(.5),e}resize(e,t){this.bkg.width=e,this.bkg.height=t;const o=e*.95,i=t*.95,n=e*.75;this.starShip.position.set(e/2,t/2),this.starShip.scale.set(p(this.starShip,o,i)),this.title.position.set(e/2,10),this.title.scale.set(p(this.title,n,i)),t<e&&(this.title.scale.set(this.title.scale.x*.7),this.title.position.x=this.title.width/2),this.popup.position.set(e/2,t/2),this.popup.scale.set(p(this.popup,o,i));const l=p(this.bottom,o,i);this.bottom.scale.set(l);const c=this.bottom.getLocalBounds();this.bottom.position.set(e/2,t-c.height*l)}moveBackground(){this.bkg.tilePosition.y=(this.bkg.tilePosition.y+.1)%this.bkg.texture.height,this.title.tilePosition.y=(this.title.tilePosition.y+.1)%this.title.texture.height}destroy(e){g.shared.remove(this.moveBackground,this),super.destroy(e)}}function Se(s,e){const t=window;t.gsap=a,t.PIXI=u(u({},Y),j),t.APP=s,t.MENU=e}le({onLoaded:ve,onClicked:Te});function ve(){var i;const s=new J({resolution:window.devicePixelRatio||1,autoDensity:!0,resizeTo:window,backgroundColor:0});((i=document.querySelector("#app"))!=null?i:document.body).appendChild(s.view);const t=new fe(s.screen.width,s.screen.height);s.stage.addChild(t),s.renderer.on("resize",t.resize,t);const o=we();Se(s,o)}function Te(){M.playMusic("simon_music")}function we(){const s=document.getElementById("menu"),e=document.getElementById("menu-toggle"),t=document.getElementById("menu-container"),o=new K.exports.Pane({container:t});return M.addSoundsControlPanel(o),e.addEventListener("pointerdown",()=>{s.classList.toggle("closed")}),o.addSeparator(),o.addButton({title:"Close menu"}).on("click",()=>{s.classList.add("closed")}),o}
